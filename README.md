# FReg - AR æ™ºæ…§è¯¾å ‚ä¼´ä¾£
  åŸºäºäººè„¸è¯†åˆ«çš„ AR æ™ºæ…§è¯¾å ‚å­¦ç”Ÿè€ƒå‹¤ä¸äº’åŠ¨ç³»ç»Ÿ



<p align="center">
  <a href="#åŠŸèƒ½ç‰¹æ€§">åŠŸèƒ½ç‰¹æ€§</a> â€¢
  <a href="#ç³»ç»Ÿæ¶æ„">ç³»ç»Ÿæ¶æ„</a> â€¢
  <a href="#å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</a> â€¢
  <a href="#ä½¿ç”¨æŒ‡å—">ä½¿ç”¨æŒ‡å—</a> â€¢
  <a href="#å¼€å‘æŒ‡å—">å¼€å‘æŒ‡å—</a>
</p>

---

## é¡¹ç›®ç®€ä»‹

FReg æ˜¯ä¸€æ¬¾ä¸“ä¸º Rokid AR çœ¼é•œè®¾è®¡çš„æ™ºæ…§è¯¾å ‚è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡äººè„¸è¯†åˆ«æŠ€æœ¯å®ç°å­¦ç”Ÿè‡ªåŠ¨è€ƒå‹¤å’Œèº«ä»½è¯†åˆ«ã€‚ç³»ç»Ÿç”±ä¸¤ä¸ª Android åº”ç”¨ç»„æˆï¼š

| åº”ç”¨ | è¿è¡Œè®¾å¤‡ | ä¸»è¦åŠŸèƒ½ |
|------|----------|----------|
| **m-app** | æ‰‹æœº | äººè„¸å½•å…¥ã€å­¦ç”Ÿç®¡ç†ã€è¯†åˆ«å¤„ç†ã€æ•°æ®å­˜å‚¨ |
| **s-app** | Rokid AR çœ¼é•œ | å›¾åƒé‡‡é›†ã€AR ç•Œé¢å±•ç¤ºã€æ‰‹åŠ¿äº¤äº’ |

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

- **å®æ—¶äººè„¸è¯†åˆ«** - åŸºäº SCRFD + MobileFaceNet çš„é«˜ç²¾åº¦äººè„¸æ£€æµ‹ä¸è¯†åˆ«
- **AR HUD æ˜¾ç¤º** - åœ¨çœ¼é•œç«¯å®æ—¶å åŠ æ˜¾ç¤ºè¯†åˆ«ç»“æœ
- **å­¦ç”Ÿç®¡ç†** - å®Œæ•´çš„å­¦ç”Ÿä¿¡æ¯ä¸äººè„¸ç‰¹å¾åº“ç®¡ç†
- **è‡ªåŠ¨è€ƒå‹¤** - è¯†åˆ«ç»“æœè‡ªåŠ¨è®°å½•ä¸ºè€ƒå‹¤æ•°æ®

### ğŸ“± æ‰‹æœºç«¯ (m-app)

- å­¦ç”Ÿä¿¡æ¯ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- é«˜è´¨é‡äººè„¸é‡‡é›†ä¸ç‰¹å¾æå–
- è®¾å¤‡è¿æ¥ä¸çŠ¶æ€ç®¡ç†
- è¯†åˆ«ç»“æœè¯¦æƒ…å±•ç¤º

### ğŸ‘“ çœ¼é•œç«¯ (s-app)

- CameraX å®æ—¶å›¾åƒé‡‡é›†
- è‡ªåŠ¨/æ‰‹åŠ¨ä¸¤ç§é‡‡é›†æ¨¡å¼
- AR ç•Œé¢æ˜¾ç¤ºè¯†åˆ«ç»“æœ
- è§¦æ§æ¿æ‰‹åŠ¿æ§åˆ¶

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          m-app (æ‰‹æœº)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ CameraX  â”‚â”€â”€â”€â–¶â”‚ ML Pipeline   â”‚â”€â”€â”€â–¶â”‚ RokidManager         â”‚ â”‚
â”‚  â”‚ /çœ¼é•œ    â”‚    â”‚ (SCRFD +      â”‚    â”‚ (BLE + Rokid SDK)    â”‚ â”‚
â”‚  â”‚ å›¾åƒ     â”‚    â”‚  MobileFaceNet)â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚ è¯†åˆ«ç»“æœ
                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        s-app (çœ¼é•œ)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ GlassesBridgeâ”‚â”€â”€â”€â–¶â”‚ HudViewModel â”‚â”€â”€â”€â–¶â”‚ HudScreen       â”‚   â”‚
â”‚  â”‚ (Socket)     â”‚    â”‚              â”‚    â”‚ (AR Overlay)    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ML Pipeline

```
å›¾åƒè¾“å…¥
    â†“
[CompositeFaceDetector]
    â”œâ”€ InsightfaceNcnnDetector (ä¸»: SCRFD via NCNN)
    â””â”€ FaceDetectorMlKit       (å¤‡: Google MLKit)
    â†“
[FaceAlignment]
    â”‚  5ç‚¹å…³é”®ç‚¹ â†’ 112x112 å¯¹é½äººè„¸
    â†“
[FaceRecognizer]
    â”‚  MobileFaceNet NCNN â†’ 512ç»´ç‰¹å¾å‘é‡
    â†“
ä½™å¼¦ç›¸ä¼¼åº¦åŒ¹é… (é˜ˆå€¼: 0.7)
    â†“
å­¦ç”ŸåŒ¹é… â†’ RokidService â†’ çœ¼é•œ HUD
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Android Studio**: Hedgehog æˆ–æ›´æ–°ç‰ˆæœ¬
- **JDK**: 11+
- **Android SDK**: API 26+ (m-app), API 31+ (s-app)
- **NDK**: ç”¨äºç¼–è¯‘ NCNN åŸç”Ÿä»£ç 

### 1. å…‹éš†ä»“åº“

```bash
git clone https://github.com/your-org/FReg.git
cd FReg
```

### 2. ä¸‹è½½æ¨¡å‹æ–‡ä»¶

```bash
cd m-app
./scripts/download_mobilefacenet.sh
```

æˆ–æ‰‹åŠ¨ä¸‹è½½ MobileFaceNet æ¨¡å‹ï¼Œæ”¾ç½®äº `m-app/app/src/main/assets/`:
- `mobilefacenet-opt.param`
- `mobilefacenet-opt.bin`

> SCRFD æ¨¡å‹å·²åŒ…å«åœ¨ä»“åº“ä¸­

### 3. é…ç½® Rokid SDK

1. è®¿é—® [ar.rokid.com](https://ar.rokid.com) â†’ è´¦å· â†’ è®¾å¤‡ç®¡ç†
2. ä¸‹è½½ SN æ–‡ä»¶ `sn_xxx.bin`
3. æ”¾ç½®äº `m-app/app/src/main/res/raw/`
4. æ›´æ–° `m-app/.../rokid/RokidManager.kt` ä¸­çš„ `CLIENT_SECRET`

### 4. ç¼–è¯‘å®‰è£…

```bash
# ç¼–è¯‘æ‰‹æœºç«¯
m-app/gradlew -p m-app assembleDebug

# ç¼–è¯‘çœ¼é•œç«¯
s-app/gradlew -p s-app assembleDebug

# å®‰è£…åˆ°è®¾å¤‡
m-app/gradlew -p m-app installDebug
s-app/gradlew -p s-app installDebug
```

## ä½¿ç”¨æŒ‡å—

### é…å¯¹æµç¨‹

1. **å¯åŠ¨çœ¼é•œç«¯åº”ç”¨** - çœ¼é•œæ˜¾ç¤º 6 ä½é…å¯¹ç 
2. **å¯åŠ¨æ‰‹æœºç«¯åº”ç”¨** - è¿›å…¥ã€Œè®¾å¤‡ã€é¡µé¢
3. **æ‰«æå¹¶è¿æ¥** - é€‰æ‹©çœ¼é•œè®¾å¤‡ï¼Œè¾“å…¥é…å¯¹ç 
4. **é…å¯¹æˆåŠŸ** - åŒæ–¹è¿›å…¥è¯†åˆ«æ¨¡å¼

### å­¦ç”Ÿå½•å…¥

1. æ‰‹æœºç«¯è¿›å…¥ã€Œå­¦ç”Ÿã€é¡µé¢
2. ç‚¹å‡»æ·»åŠ å­¦ç”Ÿï¼Œå¡«å†™åŸºæœ¬ä¿¡æ¯
3. è¿›å…¥äººè„¸é‡‡é›†ï¼Œæ‹æ‘„æ­£é¢ç…§ç‰‡
4. ç³»ç»Ÿè‡ªåŠ¨æå– 512 ç»´äººè„¸ç‰¹å¾

### è¯¾å ‚ä½¿ç”¨

1. æ•™å¸ˆä½©æˆ´ AR çœ¼é•œï¼Œæ‰‹æœºç½®äºè®²å°
2. çœ¼é•œè‡ªåŠ¨/æ‰‹åŠ¨é‡‡é›†å›¾åƒ
3. æ‰‹æœºç«¯å¤„ç†è¯†åˆ«ï¼Œç»“æœå®æ—¶æ˜¾ç¤ºåœ¨çœ¼é•œ HUD
4. è¯†åˆ«ç»“æœè‡ªåŠ¨è®°å½•è€ƒå‹¤

### æ‰‹åŠ¿æ§åˆ¶ (çœ¼é•œç«¯)

| æ‰‹åŠ¿ | åŠŸèƒ½ |
|------|------|
| å•å‡» | æ‰‹åŠ¨æ¨¡å¼ä¸‹è§¦å‘é‡‡é›† / è‡ªåŠ¨æ¨¡å¼ä¸‹æš‚åœ/æ¢å¤ |
| åŒå‡» | é‡ç½®çŠ¶æ€ |
| é•¿æŒ‰ | åˆ‡æ¢è‡ªåŠ¨/æ‰‹åŠ¨æ¨¡å¼ |
| å‰æ»‘/åæ»‘ | é¢„ç•™åŠŸèƒ½ |

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
FReg/
â”œâ”€â”€ m-app/                      # æ‰‹æœºç«¯åº”ç”¨
â”‚   â”œâ”€â”€ app/src/main/
â”‚   â”‚   â”œâ”€â”€ java/.../           # Kotlin æºç 
â”‚   â”‚   â”‚   â”œâ”€â”€ ml/             # ML æ¨¡å— (æ£€æµ‹/è¯†åˆ«)
â”‚   â”‚   â”‚   â”œâ”€â”€ rokid/          # Rokid SDK å°è£…
â”‚   â”‚   â”‚   â”œâ”€â”€ data/           # æ•°æ®å±‚ (Repository)
â”‚   â”‚   â”‚   â””â”€â”€ ui/             # Compose UI
â”‚   â”‚   â”œâ”€â”€ jni/                # Native å±‚ (NCNN/OpenCV)
â”‚   â”‚   â””â”€â”€ assets/             # æ¨¡å‹æ–‡ä»¶
â”‚   â””â”€â”€ scripts/                # å·¥å…·è„šæœ¬
â”œâ”€â”€ s-app/                      # çœ¼é•œç«¯åº”ç”¨
â”‚   â””â”€â”€ app/src/main/java/.../
â”‚       â”œâ”€â”€ camera/             # CameraX é‡‡é›†
â”‚       â”œâ”€â”€ communication/      # é€šä¿¡åè®®
â”‚       â”œâ”€â”€ input/              # æ‰‹åŠ¿è¾“å…¥
â”‚       â””â”€â”€ ui/                 # Compose HUD
â”œâ”€â”€ docs/                       # è®¾è®¡æ–‡æ¡£
â”œâ”€â”€ WARP.md                     # AI å¼€å‘åŠ©æ‰‹æŒ‡å—
â””â”€â”€ DEBUG_GUIDE.md              # è°ƒè¯•æŒ‡å—
```

### å¸¸ç”¨å‘½ä»¤

```bash
# æ„å»º
m-app/gradlew -p m-app assembleDebug
s-app/gradlew -p s-app assembleDebug

# æµ‹è¯•
m-app/gradlew -p m-app test
m-app/gradlew -p m-app test --tests "com.sustech.bojayL.ExampleUnitTest"

# Lint
m-app/gradlew -p m-app lint
s-app/gradlew -p s-app lint

# æŒ‡å®šè®¾å¤‡å®‰è£…
m-app/gradlew -p m-app installDebug -PdeviceSerial=<serial>
adb -s <serial> install -r m-app/app/build/outputs/apk/debug/app-debug.apk
```

### è°ƒè¯•

```bash
# æ‰‹æœºç«¯æ—¥å¿—
adb logcat | grep -E "(RokidService|RokidManager|RecognitionProcessor)"

# çœ¼é•œç«¯æ—¥å¿—
adb logcat | grep -E "(GlassesCamera|HudViewModel|GlassesBridge)"

# é€šä¿¡åè®®è°ƒè¯•
adb logcat | grep -E "(Received message|Sent.*result)"
```

è¯¦ç»†è°ƒè¯•æŒ‡å—è¯·å‚é˜… [DEBUG_GUIDE.md](DEBUG_GUIDE.md)ã€‚

### é€šä¿¡åè®®

**æ¶ˆæ¯ç±»å‹:**

| Key | æ–¹å‘ | æè¿° |
|-----|------|------|
| `glass_recognize` | çœ¼é•œ â†’ æ‰‹æœº | è¯†åˆ«è¯·æ±‚ (å›¾åƒ + äººè„¸æ¡†) |
| `glass_status` | çœ¼é•œ â†’ æ‰‹æœº | çŠ¶æ€ä¿¡æ¯ (ç”µé‡/æ¨¡å¼) |
| `glass_pairing_code` | çœ¼é•œ â†’ æ‰‹æœº | é…å¯¹ç  |
| `phone_result` | æ‰‹æœº â†’ çœ¼é•œ | è¯†åˆ«ç»“æœ |
| `phone_config` | æ‰‹æœº â†’ çœ¼é•œ | é…ç½®å‚æ•° |

**æ³¨æ„:** Rokid SDK ç¼ºå°‘ `writeFloat()` æ–¹æ³•ï¼Œéœ€ä½¿ç”¨:
```kotlin
writeInt32(java.lang.Float.floatToIntBits(floatValue))
```

## æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯ |
|------|------|
| è¯­è¨€ | Kotlin 2.0.21 |
| UI | Jetpack Compose + Material 3 |
| ç›¸æœº | CameraX 1.3.1 |
| ML | NCNN (Vulkan) + MLKit |
| äººè„¸æ£€æµ‹ | SCRFD (InsightFace) |
| äººè„¸è¯†åˆ« | MobileFaceNet |
| é€šä¿¡ | Rokid CxrApi SDK |
| å­˜å‚¨ | DataStore + kotlinx.serialization |

## ç›®å½•è¯´æ˜

| ç›®å½• | è¯´æ˜ |
|------|------|
| `m-app/` | æ‰‹æœºç«¯ Android åº”ç”¨ |
| `s-app/` | çœ¼é•œç«¯ Android åº”ç”¨ |
| `docs/` | PRDã€UI è®¾è®¡ç­‰æ–‡æ¡£ |
| `Rokid SDK DEMO/` | SDK ç¤ºä¾‹ä»£ç å‚è€ƒ |

## è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦æœ¯ç ”ç©¶ä½¿ç”¨ã€‚

## è‡´è°¢

- [NCNN](https://github.com/Tencent/ncnn) - é«˜æ€§èƒ½ç¥ç»ç½‘ç»œæ¨ç†æ¡†æ¶
- [InsightFace](https://github.com/deepinsight/insightface) - SCRFD äººè„¸æ£€æµ‹æ¨¡å‹
- [MobileFaceNet](https://github.com/AlfredXiangWu/MobileFaceNet) - è½»é‡çº§äººè„¸è¯†åˆ«æ¨¡å‹
- [Rokid](https://www.rokid.com/) - AR çœ¼é•œç¡¬ä»¶ä¸ SDK



